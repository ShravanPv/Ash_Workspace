from datetime import datetime

from sqlalchemy import Column, Integer, Sequence, String, DateTime, text, \
    ForeignKey, Index, UniqueConstraint

from fusion_models.fusion.base import FusionBase


class Lookup(FusionBase):
    __tablename__ = 'lookup'

    id = Column(Integer, Sequence('lookup_id_seq'), primary_key=True)

    name = Column(String(64), nullable=False)
    description = Column(String(256))

    created_on = Column(DateTime, server_default=text('(now() at time zone '
                                                      '\'utc\')'))
    modified_on = Column(DateTime, onupdate=datetime.utcnow)
    modified_by = Column(Integer, ForeignKey('users.id'), nullable=False)

    __table_args__ = (
        UniqueConstraint('name', name='_lookup_name_uc'),
    )


class LookupValues(FusionBase):
    __tablename__ = 'lookup_values'

    id = Column(Integer, Sequence('lookup_values_id_seq'), primary_key=True)

    lookup_id = Column(ForeignKey('lookup.id'), nullable=False)
    value = Column(String(64), nullable=False)
    description = Column(String(256))
    creation_mode = Column(String(64), nullable=True)

    created_on = Column(DateTime, server_default=text('(now() at time zone '
                                                      '\'utc\')'))
    modified_on = Column(DateTime, onupdate=datetime.utcnow)
    modified_by = Column(Integer, ForeignKey('users.id'), nullable=False)

    __table_args__ = (
        UniqueConstraint(
            'lookup_id', 'value', name='_lookup_values_lookup_id_value_uc'
        ),
        Index('lookup_values_lookup_id_idx', 'lookup_id'),
    )
